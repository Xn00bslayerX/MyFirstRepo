<!DOCTYPE HTML>
<html>

<head>
   <title>Products</title>
   <link rel="stylesheet" href="styles.css" type="text/css">
   <style>
      img {
         max-height: 30vh;
      }
   </style>
</head>

<body>
   <h1>Products Catalog</h1>
   <div id="navbar"></div>
   <script>
      fetch('navbar.html')
         .then(response => response.text())
         .then(data => {
            document.getElementById('navbar').innerHTML = data;
         });
   </script>
   <section id="Searches">
      <div>
         <input type="text" id="searchInputProducts" placeholder="Product name">
         <button onclick="searchProducts()">Search</button>
      </div>
      <div>
         <input type="text" id="searchInputCategory" placeholder="Category name">
         <button onclick="searchCategory()">Search</button>
      </div>
   </section>
   <div class="card-container">

      <table id="productTable">
         <thead>
            <th>Image</th>
            <th>Name</th>
            <th>Category</th>
            <th>Description</th>
            <th>Price</th>
         </thead>
         <tbody>
         </tbody>
      </table>
   </div>
   <script>
      const server = "https://makeup-api.herokuapp.com/api/v1/products.json";
      let productsData = []; // Store all products data

      async function getAndLoadAPIdata() {
         let response = await fetch(server);
         let data = await response.json();
         console.log(data, "fetched from", server);
         productsData = data; // Store all products data in the variable
         loadProductsTable(data);
      }

      function loadProductsTable(data) {
         const productTableBody = document.querySelector('#productTable tbody');
         productTableBody.innerHTML = '';

         if (data.length === 0) {
            // Handle case when no matching products or categories are found
            const noResultsRow = document.createElement('tr');
            noResultsRow.innerHTML = '<td colspan="5">No results found</td>';
            productTableBody.appendChild(noResultsRow);
         } else {
            data.forEach(element => {
               let row = document.createElement('tr');
               row.innerHTML = `
            <td><img src="${element.image_link}" alt="Product Image"></td>
            <td><a href="${element.product_link}">${element.name}</a></td>
            <td>${element.category}</td>
            <td>${element.description}</td>
            <td>${element.price_sign}${element.price} ${element.currency}</td>
         `;
               console.log(row, "is being appended");
               productTableBody.appendChild(row);
            });
         }
      }

      function searchProducts() {
         const searchTerm = document.getElementById('searchInputProducts').value.toLowerCase();
         if (searchTerm) {
            const filteredData = productsData.filter(product => product.name && product.name.toLowerCase().includes(searchTerm));
            loadProductsTable(filteredData);
         }
      }

      function searchCategory() {
         const searchTerm = document.getElementById('searchInputCategory').value.toLowerCase();
         if (searchTerm) {
            const filteredData = productsData.filter(product => product.category && product.category.toLowerCase().includes(searchTerm));
            loadProductsTable(filteredData);
         }
      }

      // Call the function to fetch and load the API data
      getAndLoadAPIdata();
   </script>
</body>

</html>
